<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  
  <div>
    <button onclick="ex1()">ex1</button>
  </div>
  <script>

    // 비동기통신 : 응답을 기다리지 않는다.
    const ex1 = ()=>{

      // 1) 변수 선언 : 초기화가 없으면 undefined
      let authorId;

      // 2) 비동기작업
      const xhr = new XMLHttpRequest();
      xhr.open('GET', 'https://thetestrequest.com/authors/1');
      xhr.send();
      xhr.addEventListener('readystatechange', ()=>{
        if(xhr.readyState === 4 && xhr.status === 200){
          const author = JSON.parse(xhr.responseText);
          const {id, name, email, avatar, created_at, updated_at} = author;
          authorId = id;
        }
      })

      // 3) 변수 확인 (비동기작업 수행 결과로 authorId 값이 채워지지만, 2)번 과정이 끝날때까지 기다리지 않고 authorId 변수 값을 확인한다.)
      console.log(authorId);

    }

  </script>

  <div>
    <button onclick="ex2()">ex2</button>
  </div>
  <script>

    const ex2 = ()=>{

      // 1) 변수 선언
      let authorId;

      // 2) 비동기작업
      /* Promise 객체 생성 */
      const promise1 = new Promise((resolve, reject)=>{
        const xhr = new XMLHttpRequest();
        xhr.open('GET', 'https://thetestrequest.com/authors/1');
        xhr.send();
        xhr.addEventListener('readystatechange', (evt)=>{
          if(xhr.readyState !== 4)
            return;
          if(xhr.status !== 200)
            reject(xhr.statusText);
          resolve(JSON.parse(xhr.responseText));
        })
      })

      // 3) 변수 확인
      /* Promise 객체 메소드 실행(성공시 then(), 실패시 catch()) */
      promise1
      .then((author)=>{
        authorId = author.id;
        console.log(authorId);
      })
      .catch((statusText)=>{
        alert(statusText);
      });

    }

  </script>

</body>
</html>